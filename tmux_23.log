[I 2024-08-20 02:47:36,226] Using an existing study with name '24-08-20-day_hour-minmax-farm_66' instead of creating a new one.
Creating study "24-08-20-day_hour-minmax-farm_66" with storage "sqlite:////data/Pein/Pytorch/Wind-Power-Prediction/optuna_results/24-08-20-day_hour-minmax/24-08-20-day_hour-minmax-farm_66.db?mode=wal"...
Using sampler cma with seed 56966
Using sampler : CmaEsSampler, pruner : <optuna.pruners._median.MedianPruner object at 0x7fd5b3cffee0>
  0%|          | 0/6 [00:00<?, ?it/s]/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/distributions.py:700: UserWarning: The distribution is specified by [4, 8] and step=8, but the range is not divisible by `step`. It will be replaced by [4, 4].
  warnings.warn(
/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/distributions.py:700: UserWarning: The distribution is specified by [32, 512] and step=64, but the range is not divisible by `step`. It will be replaced by [32, 480].
  warnings.warn(
/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/distributions.py:700: UserWarning: The distribution is specified by [16, 256] and step=32, but the range is not divisible by `step`. It will be replaced by [16, 240].
  warnings.warn(
Seed set to 17
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
You are using a CUDA device ('NVIDIA A100 80GB PCIe') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [7]

  | Name      | Type    | Params | Mode 
----------------------------------------------
0 | model     | Model   | 1.3 M  | train
1 | criterion | MSELoss | 0      | train
----------------------------------------------
1.3 M     Trainable params
0         Non-trainable params
1.3 M     Total params
5.256     Total estimated model params size (MB)
143       Modules in train mode
0         Modules in eval mode
Metric Loss/val improved. New best score: 0.159
Metric Loss/val improved by 0.025 >= min_delta = 0.0. New best score: 0.133
Metric Loss/val improved by 0.028 >= min_delta = 0.0. New best score: 0.106
Metric Loss/val improved by 0.019 >= min_delta = 0.0. New best score: 0.086
Metric Loss/val improved by 0.004 >= min_delta = 0.0. New best score: 0.082
Metric Loss/val improved by 0.006 >= min_delta = 0.0. New best score: 0.076
Traceback (most recent call last):
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/storages/_rdb/storage.py", line 73, in _create_scoped_session
    session.commit()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO trial_intermediate_values (trial_id, step, intermediate_value, intermediate_value_type) VALUES (?, ?, ?, ?)]
[parameters: (24, 15, 0.08506490219384433, 'FINITE')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/data/Pein/Pytorch/Wind-Power-Prediction/run_scripts/run_optuna.py", line 279, in objective
    training_duration = run_training(
  File "/data/Pein/Pytorch/Wind-Power-Prediction/run_scripts/run_optuna.py", line 194, in run_training
    trainer.fit(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 538, in fit
    call._call_and_handle_interrupt(
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 47, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 574, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 981, in _run
    results = self._run_stage()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1025, in _run_stage
    self.fit_loop.run()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/loops/utilities.py", line 178, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 142, in run
    return self.on_run_end()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 268, in on_run_end
    self._on_evaluation_end()
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 313, in _on_evaluation_end
    call._call_callback_hooks(trainer, hook_name, *args, **kwargs)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 218, in _call_callback_hooks
    fn(trainer, trainer.lightning_module, *args, **kwargs)
  File "/data/Pein/Pytorch/Wind-Power-Prediction/utils/callback.py", line 421, in on_validation_end
    self.trial.report(weighted_loss, trainer.current_epoch)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/trial/_trial.py", line 500, in report
    self.storage.set_trial_intermediate_value(self._trial_id, step, value)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/storages/_cached_storage.py", line 192, in set_trial_intermediate_value
    self._backend.set_trial_intermediate_value(trial_id, step, intermediate_value)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/storages/_rdb/storage.py", line 682, in set_trial_intermediate_value
    with _create_scoped_session(self.scoped_session, True) as session:
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/contextlib.py", line 142, in __exit__
    next(self.gen)
  File "/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/storages/_rdb/storage.py", line 90, in _create_scoped_session
    raise optuna.exceptions.StorageInternalError(message) from e
optuna.exceptions.StorageInternalError: An exception is raised during the commit. This typically happens due to invalid data in the commit, e.g. exceeding max length. 
                                       0%|          | 0/6 [06:01<?, ?it/s]Best trial: 0. Best value: 0.0673834:   0%|          | 0/6 [06:05<?, ?it/s]Best trial: 0. Best value: 0.0673834:  17%|█▋        | 1/6 [06:05<30:27, 365.58s/it]/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/distributions.py:700: UserWarning: The distribution is specified by [4, 8] and step=8, but the range is not divisible by `step`. It will be replaced by [4, 4].
  warnings.warn(
/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/distributions.py:700: UserWarning: The distribution is specified by [32, 512] and step=64, but the range is not divisible by `step`. It will be replaced by [32, 480].
  warnings.warn(
/root/miniconda3/envs/Pein_310/lib/python3.10/site-packages/optuna/distributions.py:700: UserWarning: The distribution is specified by [16, 256] and step=32, but the range is not divisible by `step`. It will be replaced by [16, 240].
  warnings.warn(
                                                                                    Best trial: 0. Best value: 0.0673834:  17%|█▋        | 1/6 [06:51<30:27, 365.58s/it]                                                                                    Best trial: 0. Best value: 0.0673834:  17%|█▋        | 1/6 [06:51<30:27, 365.58s/it]                                                                                    Best trial: 0. Best value: 0.0673834:  17%|█▋        | 1/6 [06:51<30:27, 365.58s/it]                                                                                    Best trial: 0. Best value: 0.0673834:  17%|█▋        | 1/6 [06:52<30:27, 365.58s/it]                                                                                    Best trial: 0. Best value: 0.0673834:  17%|█▋        | 1/6 [06:52<30:27, 365.58s/it]Seed set to 17
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [7]

  | Name      | Type    | Params | Mode 
----------------------------------------------
0 | model     | Model   | 1.3 M  | train
1 | criterion | MSELoss | 0      | train
----------------------------------------------
1.3 M     Trainable params
0         Non-trainable params
1.3 M     Total params
5.008     Total estimated model params size (MB)
143       Modules in train mode
0         Modules in eval mode
Metric Loss/val improved. New best score: 0.191
Metric Loss/val improved by 0.018 >= min_delta = 0.0. New best score: 0.173
Metric Loss/val improved by 0.037 >= min_delta = 0.0. New best score: 0.136
Metric Loss/val improved by 0.041 >= min_delta = 0.0. New best score: 0.094
Metric Loss/val improved by 0.013 >= min_delta = 0.0. New best score: 0.081
Metric Loss/val improved by 0.017 >= min_delta = 0.0. New best score: 0.065
Metric Loss/val improved by 0.004 >= min_delta = 0.0. New best score: 0.061
Metric Loss/val improved by 0.004 >= min_delta = 0.0. New best score: 0.058
